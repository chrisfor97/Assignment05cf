---
title: 'Assignment V: GitHub and the ticketmaster.com API'
author: "Christopher Forschner"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setting up a new GitHub repository

(1) Register on github.com in case you have not done this already.
(2) Initialize a new public repository for this assignment on GitHub.
(3) For the following exercises of this assignment, follow the standard Git workflow (i.e., pull the latest
version of the project to your local computer, then stage, commit, and push all the modifications that you
make throughout the project). Every logical programming step should be well documented on GitHub
with a meaningful commit message, so that other people (e.g., your course instructor) can follow and
understand the development history. You can do this either using Shell commands or a Git GUI of your
choice.
(4) In the HTML file that you submit, include the hyperlink to the project repository (e.g., https://github.
com/yourUserName/yourProjectName)

```{r}
git_url <- 'https://github.com/chrisfor97/Assignment05cf'
```
## Getting to know the API
(5) Visit the documentation website for the API provided by ticketmaster.com (see here). Familiarize yourself with the features and functionalities of the Ticketmaster Discovery API. Have a particular look at rate limits.
Features of the Ticketmaster Discovery API: 
* Searching events by keyword in a certain location (lat/long)
* Getting events for a particular artist OR venue in a specific country/city/zip code/DMA/etc
* Getting hi-res images for a particular event or artist.
* Search events of a certain genre in a particular location for a certain promoter
* rate limits: 5000 API calls per day and rate limitation of 5 requests per second
    + increasing rate limit is also possible but specific conditions need to be fullfilled. However, for this Assignment, this is not necessary


(6) Whithin the scope of this assignment, you do not have to request your own API key. Instead retrieve
a valid key from the API Explorer. This API key enables you to perform the GET requests needed
throughout this assignment. Even though this API key is not secret per se (it is publicly visible on the
API Explorer website), please comply to the common secrecy practices discussed in the lecture and the
tutorial: Treat the API key as a secret token. Your API key should neither appear in the code that you
are submitting nor in your public GitHub repository.

```{r}
library(jsonlite)
library(httr)
library(tidyverse)
library(rlist)
```

```{r}
source('ticketmaster_api.R')
```

#Interacting with the API - the basics
(7) Perform a first GET request, that searches for event venues in Germany (countryCode = "DE"). Extract the content from the response object and inspect the resulting list. Describe what you can see.
```{r}
tickets_de <- GET('https://app.ticketmaster.com/discovery/v2/venues', 
                  query=list("apikey"=ticketmaster_key,
                             "countryCode"="DE",
                             "locale"="*")) %>% content

tickets_de
```
```{r}
ticketsde_length <- length(tickets_de$`_embedded`$venues)

names <- vector("character", ticketsde_length)
city <- vector("character", ticketsde_length)
postal_Code <- vector("character", ticketsde_length)
address <- vector("character", ticketsde_length)
url <- vector("character", ticketsde_length)
longitude <- numeric(ticketsde_length)
latitude <- numeric(ticketsde_length)

for(i in 1:ticketsde_length) {
  if("name" %in% names(tickets_de[[i]])) {
    names[i] <- tickets[[i]]$name
  } else {
    names[i] <- NA
  }
  if("city" %in% names(tickets_de[[i]])) {
    city[i] <- tickets[[i]]$city$name
  } else {
    city[i] <- NA
  }
  if("postalCode" %in% names(tickets_de[[i]])) {
    postal_Code[i] <- tickets[[i]]$postalCode
  } else {
    postal_Code[i] <- NA
  }
  if("address" %in% names(tickets_de[[i]])) {
    address[i] <- tickets[[i]]$address$line1
  } else {
    address[i] <- NA
  }
  if("url" %in% names(tickets_de[[i]])) {
    url[i] <- tickets[[i]]$url
  } else {
    url[i] <- NA
  }
  if("location" %in% names(tickets_de[[i]])) {
    longitude[i] <- tickets[[i]]$location$longitude
    latitude[i] <- tickets[[i]]$location$latitude
  } else {
    longitude[i] <- NA
    latitude[i] <- NA
  }
}

#store them in a data frame
tickets_content_df <- data.frame(name = names,
                                 city = city,
                                 postalCode = postal_Code,
                                 address = address,
                                 url = url,
                                 longitude = longitude,
                                 latitude = latitude)

print(tickets_content_df)

```



(8) Extract the name, the *city*, the *postalCode* and *address*, as well as the *url* and the *longitude* and *latitude* of the venues to a data frame. This data frame should have the following structure:






























